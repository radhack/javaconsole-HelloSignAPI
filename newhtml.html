<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Signing Test</title>
        <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
        <script type="text/javascript" src="//s3.amazonaws.com/cdn.hellosign.com/public/js/hellosign-embedded.LATEST.min.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/js-cookie/2.1.1/js.cookie.js"></script>
    </head>
    <body>
        <h1>UX2 - main</h1>
        <h2>Reminder: Use test_mode with the POST API request when domain verification is skipped</h2>
        <div>
            <label>Your client ID here</label>
            <input type="text" id="client_id" value="<?php echo $_GET['client_id'];?>"/>
        </div>
        <div>
            <label>Sign or template URL</label>
            <input type="text" id="sign_or_template_url" value="<?php echo $_GET['sign_or_template_url'];?>"/>
        </div>
        <div>
            <label>Close and redirect on completion? </label>
            <input type="checkbox" id="close_and_redirect" checked>
        </div>
        <div>
            <label>Skip domain verification? </label>
            <input type="checkbox" id="skip_domain_verification" checked>
        </div>
        <button id="action_button">Click here to view/edit the sig request</button>
        <script>
            $(function () {

                var previous_client_id = Cookies.get('embeddedcheck_client_id');
                if (previous_client_id) {
                    $('#client_id').val(previous_client_id);
                }

                $('#client_id').on('change', function (e) {
                    var value = $('#client_id').val();
                    Cookies.set('embeddedcheck_client_id', value, {expires: 1});
                });

                $('#action_button').click(function (e) {
                    var client_id = $('#client_id').val();
                    var sign_or_template_url = $('#sign_or_template_url').val();
                    var close_and_redirect = $('#close_and_redirect').is(':checked');
                    var skip_domain_verification = $('#skip_domain_verification').is(':checked');
                    HelloSign.init(client_id);
                    HelloSign.open({
                        url: sign_or_template_url,
                        uxVersion: 2,
                        allowCancel: true,
                        skipDomainVerification: skip_domain_verification,
                        debug: true,
                        healthCheckTimeoutMs: 300000, //300000 is five minutes
                        messageListener: function (eventData) {
                            if (eventData.event == HelloSign.EVENT_SIGNED) {
                                console.log(eventData);
                                if (close_and_redirect) {
                                    window.location = 'thanks';
                                } else {
                                    window.alert = 'thanks for playing!';
                                }
                            }
                            if (eventData.event == HelloSign.EVENT_CANCELED) {
                                window.location = 'callback';
                            }
                            if (eventData.event == "signature_request_sent") {
                                console.log(eventData);
                                window.alert = ("HelloSign.EVENT_SENT Alert Received");
                            }
                            if (eventData.event == HelloSign.EVENT_ERROR) {
                                window.alert = 'There was an error';
                            }
                            if (eventData.event == "template_created") {
                                console.log(eventData);
                                window.alert = ("EVENT_TEMPLATE_CREATED Alert Received");
                            }
                        }
                    });
                });
            });
        </script>
        <hr>
        <hr>
        <h1>UX1</h1>
        <h2>You'll need to use test_mode with the POST, as domain verification is skipped</h2>
        <div>
            <label>Your client ID</label>
            <input type="text" id="client_id2" />
        </div>
        <div>
            <label>Sign or template URL</label>
            <input type="text" id="sign_or_template_url2" />
        </div>
        <button id="action_button2">Click here to view/edit the sig request</button>
        <script>
            $(function () {

                $('#action_button2').click(function (e) {
                    var client_id = $('#client_id2').val();
                    var sign_or_template_url = $('#sign_or_template_url2').val();
                    HelloSign.init(client_id);
                    HelloSign.open({
                        url: sign_or_template_url,
                        skipDomainVerification: true,
<!--redirectUrl: "http://embeddedcheck.com/thanks",-->
                    });
                });
            });
        </script>

        <!--
        <script>
                function getQueryVariable(variable)
        {
               var query = window.location.search.substring(1);
               var vars = query.split("&");
               for (var i=0;i<vars.length;i++) {
                       var pair = vars[i].split("=");
                       if(pair[0] == variable){return pair[1];}
               }
               return(false);
        }
        
        var clientId = getQueryVariable('client_id');
        var sign_or_template_url = getQueryVariable('sign_or_template_URL');
        </script>
        -->
    </body>
</html>